@page "/transcribe"
@inject TranscriptionApiService ApiService
@inject ILogger<Transcribe> Logger
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer
@implements IDisposable

<PageTitle>Transcribe Audio</PageTitle>

<div class="transcribe-container">
    <h1>üéôÔ∏è Audio Transcription</h1>

    <!-- Top Row: File Selection + Configuration side by side -->
    <div class="top-columns">
        <!-- Column 1: File Selection -->
        <div class="section section-file">
            <div class="section-header" @onclick="() => fileExpanded = !fileExpanded">
                <h2>üìÅ Select Audio File</h2>
                <span class="collapse-icon">@(fileExpanded ? "‚ñæ" : "‚ñ∏")</span>
            </div>
            @if (fileExpanded)
            {
                <div class="section-body">
                    <div class="file-drop-zone">
                        <InputFile id="file-input"
                                   OnChange="HandleFileSelected"
                                   accept=".wav,.mp3,.flac"
                                   class="file-input-overlay" />
                        <div class="file-select-label">
                            <span class="upload-icon">üìÅ</span>
                            <span class="upload-text">Click to select a file or drag and drop here</span>
                            <span class="supported-formats">Supported: WAV, MP3, FLAC (max 50MB)</span>
                        </div>
                    </div>

                    <div class="selected-file-info">
                        <div class="file-icon">üéµ</div>
                        <div class="file-details">
                            <div class="file-name">@selectedFileName</div>
                            <div class="file-size">@FormatFileSize(selectedFileSize)</div>
                        </div>
                        <button class="btn-clear" @onclick="ClearFile" title="Clear file">‚úï</button>
                    </div>
                </div>
            }
        </div>

        <!-- Column 2: Configuration Options (collapsed by default) -->
        <div class="section section-config">
            <div class="section-header" @onclick="() => configExpanded = !configExpanded">
                <h2>‚öôÔ∏è Configuration Options</h2>
                <span class="collapse-icon">@(configExpanded ? "‚ñæ" : "‚ñ∏")</span>
            </div>
            @if (configExpanded)
            {
                <div class="section-body">
                    <div class="config-grid">
                        <div class="config-option">
                            <label for="modelSelect">ASR Model:</label>
                            <select id="modelSelect" @bind="selectedModelKey" @bind:after="OnModelChanged" class="config-select">
                                <option value="parakeet">Parakeet (English, with timestamps)</option>
                                <option value="canary">Canary-1B (Multilingual, no timestamps)</option>
                            </select>
                        </div>

                        <div class="config-option">
                            <label for="languageSelect">Language:</label>
                            <select id="languageSelect" @bind="selectedLanguageCode" class="config-select" disabled="@(!IsLanguageSelectionEnabled)">
                                <option value="en">English (en)</option>
                                <option value="es">Spanish (es)</option>
                                <option value="de">German (de)</option>
                                <option value="fr">French (fr)</option>
                            </select>
                            @if (!IsLanguageSelectionEnabled)
                            {
                                <small class="config-hint">Language selection available only for Canary model</small>
                            }
                        </div>

                        <div class="config-option">
                            <label for="timestampCheck">
                                <input type="checkbox" id="timestampCheck" @bind="requestTimestamps" disabled="@(!CanGenerateTimestamps)" />
                                Generate Timestamps
                            </label>
                            @if (!CanGenerateTimestamps)
                            {
                                <small class="config-hint">Timestamps not supported by selected model</small>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Action Button -->
    <div class="section section-action">
        <button class="btn-transcribe" @onclick="TranscribeAudio" disabled="@isProcessing">
            @if (isProcessing)
            {
                <span class="spinner-small"></span>
                <span>Processing...</span>
            }
            else
            {
                <span>‚ñ∂Ô∏è Start Transcription</span>
            }
        </button>

        @if (isProcessing && !string.IsNullOrEmpty(currentJobId))
        {
            <button class="btn-cancel" @onclick="CancelJob">
                <span>‚èπÔ∏è Cancel Job</span>
            </button>
        }
    </div>

    <!-- Transcription Result with Tabs -->
    <div class="section section-result">
        <h2>üìÑ Transcription Result</h2>
        <div class="result-tabs">
            <button class="result-tab @(activeResultTab == "text" ? "active" : "")" @onclick='() => activeResultTab = "text"'>
                Text
            </button>
            <button class="result-tab @(activeResultTab == "srt" ? "active" : "")" @onclick="ShowSrtTab" disabled="@(!isTranscriptionComplete)">
                SRT
            </button>
            <button class="result-tab @(activeResultTab == "txt" ? "active" : "")" @onclick="ShowTxtTab" disabled="@(!isTranscriptionComplete)">
                TXT
            </button>
        </div>
        <div class="result-tab-content">
            @if (activeResultTab == "text")
            {
                <textarea class="result-textarea"
                          readonly
                          placeholder="Transcription will appear here..."
                          value="@transcriptionText"></textarea>
            }
            else if (activeResultTab == "srt")
            {
                <div class="result-format-header">
                    <span class="format-badge srt-badge">SRT Format</span>
                    <button class="btn-copy" @onclick="() => CopyToClipboard(srtContent)" title="Copy SRT">üìã Copy</button>
                    <button class="btn-download" @onclick="DownloadSrt" title="Download SRT">‚¨áÔ∏è Download</button>
                </div>
                <pre class="result-pre">@(string.IsNullOrEmpty(srtContent) ? "No SRT data available. Timestamps may not have been generated." : srtContent)</pre>
            }
            else if (activeResultTab == "txt")
            {
                <div class="result-format-header">
                    <span class="format-badge txt-badge">TXT Format</span>
                    <button class="btn-copy" @onclick="() => CopyToClipboard(txtContent)" title="Copy TXT">üìã Copy</button>
                    <button class="btn-download" @onclick="DownloadTxt" title="Download TXT">‚¨áÔ∏è Download</button>
                </div>
                <pre class="result-pre">@(string.IsNullOrEmpty(txtContent) ? "No text data available." : txtContent)</pre>
            }
        </div>
    </div>
</div>

<!-- Fixed Bottom Progress Log -->
<div class="fixed-log @(logExpanded ? "expanded" : "collapsed")">
    <div class="fixed-log-header" @onclick="() => logExpanded = !logExpanded">
        <h3>üìã Progress Log</h3>
        <span class="log-badge">@progressLogs.Count</span>
        <span class="collapse-icon">@(logExpanded ? "‚ñæ" : "‚ñ∏")</span>
    </div>
    @if (logExpanded)
    {
        <div class="console-log" @ref="logElement">
            @foreach (var log in progressLogs)
            {
                <div class="log-entry @log.Level">
                    <span class="log-timestamp">[@log.Timestamp.ToString("HH:mm:ss")]</span>
                    <span class="log-message">@log.Message</span>
                </div>
            }
        </div>
    }
</div>

@code {
    private IBrowserFile? selectedFile;
    private string selectedFileName = string.Empty;
    private long selectedFileSize = 0;
    private bool isProcessing = false;
    private string transcriptionText = string.Empty;
    private List<LogEntry> progressLogs = new();
    private ElementReference logElement;
    private string? currentJobId;

    // Collapse/expand state
    private bool fileExpanded = true;
    private bool configExpanded = false; // collapsed by default
    private bool logExpanded = true;     // expanded by default

    // Result tabs
    private string activeResultTab = "text";
    private bool isTranscriptionComplete = false;
    private string srtContent = string.Empty;
    private string txtContent = string.Empty;
    private Segment[]? lastSegments;

    // Configuration fields
    private string selectedModelKey = "parakeet";
    private string selectedLanguageCode = "en";
    private bool requestTimestamps = true;

    // Computed properties for UI state
    private bool IsLanguageSelectionEnabled => selectedModelKey == "canary";
    private bool CanGenerateTimestamps => selectedModelKey == "parakeet";

    private void OnModelChanged()
    {
        if (selectedModelKey == "parakeet")
        {
            requestTimestamps = true;
        }
        else if (selectedModelKey == "canary")
        {
            requestTimestamps = false;
        }

        AddLog($"Model changed to: {selectedModelKey}", "info");
    }

    protected override void OnInitialized()
    {
        AddLog("System ready. Select an audio file to begin.", "info");
    }

    public void Dispose()
    {
        // Cleanup if needed
    }

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        selectedFile = e.File;
        selectedFileName = e.File.Name;
        selectedFileSize = e.File.Size;

        AddLog($"File selected: {e.File.Name} ({FormatFileSize(e.File.Size)})", "success");
        StateHasChanged();
    }

    private void ClearFile()
    {
        selectedFile = null;
        selectedFileName = string.Empty;
        selectedFileSize = 0;
        transcriptionText = string.Empty;
        srtContent = string.Empty;
        txtContent = string.Empty;
        lastSegments = null;
        isTranscriptionComplete = false;
        activeResultTab = "text";
        currentJobId = null;
        AddLog("File cleared", "info");
        StateHasChanged();
    }

    private async Task TranscribeAudio()
    {
        if (selectedFile == null)
        {
            AddLog("‚ö†Ô∏è Error: No file selected. Please select a file first.", "error");
            return;
        }

        if (isProcessing)
        {
            AddLog("‚ö†Ô∏è Warning: Transcription already in progress.", "warning");
            return;
        }

        isProcessing = true;
        isTranscriptionComplete = false;
        transcriptionText = string.Empty;
        srtContent = string.Empty;
        txtContent = string.Empty;
        lastSegments = null;
        activeResultTab = "text";
        StateHasChanged();

        try
        {
            AddLog($"Starting async transcription job for: {selectedFile.Name}", "info");
            AddLog($"Configuration: Model={selectedModelKey}, Language={selectedLanguageCode}, Timestamps={requestTimestamps}", "info");
            AddLog("Uploading file to server...", "info");

            var jobStart = await ApiService.StartTranscriptionJobAsync(
                selectedFile,
                selectedModelKey,
                IsLanguageSelectionEnabled ? selectedLanguageCode : null,
                requestTimestamps);
            currentJobId = jobStart.JobId;

            AddLog($"‚úì Upload complete - Job ID: {currentJobId}", "success");
            AddLog($"Job status: {jobStart.Status}", "info");
            AddLog("Monitoring job progress...", "info");

            await PollJobStatus(currentJobId);
        }
        catch (Exception ex)
        {
            AddLog($"‚úó Error: {ex.Message}", "error");
            Logger.LogError(ex, "Transcription job failed");
            isProcessing = false;
            StateHasChanged();
        }
    }

    private async Task PollJobStatus(string jobId)
    {
        const int maxAttempts = 120;
        int attempts = 0;

        while (attempts < maxAttempts && isProcessing)
        {
            try
            {
                await Task.Delay(5000);

                var jobInfo = await ApiService.GetJobStatusAsync(jobId);

                if (jobInfo.Status == "completed")
                {
                    AddLog("‚úì Job completed! Retrieving results...", "success");

                    var result = await ApiService.GetJobResultAsync(jobId);
                    transcriptionText = result.Text;
                    lastSegments = result.Segments;
                    isTranscriptionComplete = true;

                    // Pre-generate TXT and SRT content
                    txtContent = result.Text;
                    srtContent = GenerateSrtContent(result.Segments);

                    AddLog($"‚úì Transcription complete! ({result.Segments?.Length ?? 0} segments)", "success");

                    if (!string.IsNullOrEmpty(result.Text))
                    {
                        AddLog($"Total text length: {result.Text.Length} characters", "info");
                    }

                    AddLog("Ready for next transcription. SRT and TXT tabs are now available.", "success");
                    isProcessing = false;
                    break;
                }
                else if (jobInfo.Status == "failed")
                {
                    AddLog($"‚úó Job failed: {jobInfo.Error ?? "Unknown error"}", "error");
                    isProcessing = false;
                    break;
                }
                else if (jobInfo.Status == "cancelled")
                {
                    AddLog("Job was cancelled", "warning");
                    isProcessing = false;
                    break;
                }
                else
                {
                    if (attempts % 6 == 0)
                    {
                        AddLog($"Job status: {jobInfo.Status} (elapsed: {attempts * 5}s)", "info");
                    }
                }

                attempts++;
                StateHasChanged();
            }
            catch (Exception ex)
            {
                AddLog($"‚úó Error polling job status: {ex.Message}", "error");
                Logger.LogError(ex, "Failed to poll job status");
                isProcessing = false;
                break;
            }
        }

        if (attempts >= maxAttempts)
        {
            AddLog("‚ö†Ô∏è Job polling timeout. The job may still be processing on the server.", "warning");
            isProcessing = false;
        }

        StateHasChanged();
    }

    private async Task CancelJob()
    {
        if (string.IsNullOrEmpty(currentJobId))
        {
            AddLog("‚ö†Ô∏è No active job to cancel", "warning");
            return;
        }

        try
        {
            AddLog($"Cancelling job: {currentJobId}", "info");
            var result = await ApiService.CancelJobAsync(currentJobId);
            AddLog($"‚úì {result.Message}", "success");
            isProcessing = false;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            AddLog($"‚úó Error cancelling job: {ex.Message}", "error");
            Logger.LogError(ex, "Failed to cancel job");
        }
    }

    // --- Result Tab Helpers ---

    private void ShowSrtTab()
    {
        if (!isTranscriptionComplete) return;
        activeResultTab = "srt";
        if (string.IsNullOrEmpty(srtContent) && lastSegments != null)
        {
            srtContent = GenerateSrtContent(lastSegments);
        }
    }

    private void ShowTxtTab()
    {
        if (!isTranscriptionComplete) return;
        activeResultTab = "txt";
        if (string.IsNullOrEmpty(txtContent))
        {
            txtContent = transcriptionText;
        }
    }

    private string GenerateSrtContent(Segment[]? segments)
    {
        if (segments == null || segments.Length == 0)
            return string.Empty;

        var sb = new System.Text.StringBuilder();
        for (int i = 0; i < segments.Length; i++)
        {
            var seg = segments[i];
            sb.AppendLine((i + 1).ToString());
            sb.AppendLine($"{SecondsToSrtTime(seg.Start)} --> {SecondsToSrtTime(seg.End)}");
            sb.AppendLine(seg.Text.Trim());
            sb.AppendLine();
        }
        return sb.ToString().TrimEnd();
    }

    private static string SecondsToSrtTime(double seconds)
    {
        var ts = TimeSpan.FromSeconds(seconds);
        return $"{(int)ts.TotalHours:D2}:{ts.Minutes:D2}:{ts.Seconds:D2},{ts.Milliseconds:D3}";
    }

    private string GetOutputFileName(string extension)
    {
        var baseName = Path.GetFileNameWithoutExtension(selectedFileName);
        var timestamp = DateTime.Now.ToString("yyyyMMdd_HHmmss");
        return $"{timestamp}_{baseName}{extension}";
    }

    private async Task DownloadSrt() => await DownloadContent(srtContent, GetOutputFileName(".srt"));

    private async Task DownloadTxt() => await DownloadContent(txtContent, GetOutputFileName(".txt"));

    private async Task CopyToClipboard(string content)
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("copyToClipboard", content);
            AddLog("Content copied to clipboard.", "success");
        }
        catch (Exception ex)
        {
            AddLog($"Failed to copy: {ex.Message}", "error");
        }
    }

    private async Task DownloadContent(string content, string fileName)
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("downloadTextFile", content, fileName);
            AddLog($"Downloaded {fileName}", "success");
        }
        catch (Exception ex)
        {
            AddLog($"Failed to download: {ex.Message}", "error");
        }
    }

    // --- Logging ---

    private void AddLog(string message, string level = "info")
    {
        progressLogs.Add(new LogEntry
        {
            Timestamp = DateTime.Now,
            Message = message,
            Level = level
        });

        if (progressLogs.Count > 100)
        {
            progressLogs.RemoveAt(0);
        }

        StateHasChanged();
    }

    private string FormatFileSize(long bytes)
    {
        if (bytes < 1024) return $"{bytes} B";
        if (bytes < 1024 * 1024) return $"{bytes / 1024.0:F1} KB";
        return $"{bytes / (1024.0 * 1024.0):F1} MB";
    }

    private class LogEntry
    {
        public DateTime Timestamp { get; set; }
        public string Message { get; set; } = string.Empty;
        public string Level { get; set; } = "info";
    }
}

<style>
    .transcribe-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        padding-bottom: 320px; /* space for fixed log */
    }

    .transcribe-container h1 {
        color: #333;
        border-bottom: 3px solid #76b900;
        padding-bottom: 10px;
        margin-bottom: 30px;
        font-size: 2rem;
    }

    /* Top columns layout */
    .top-columns {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    /* Section Styling */
    .section {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
    }

    .section-header:hover {
        background: rgba(0, 0, 0, 0.02);
    }

    .section-header h2 {
        color: #333;
        font-size: 1.2rem;
        margin: 0;
        border: none;
        padding: 0;
    }

    .collapse-icon {
        font-size: 1.2rem;
        color: #888;
        transition: transform 0.2s;
    }

    .section-body {
        padding: 0 20px 20px 20px;
    }

    .section h2 {
        color: #333;
        font-size: 1.3rem;
        margin: 0 0 15px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
    }

    /* File Selection */
    .section-file {
        border-left: 4px solid #76b900;
    }

    .file-drop-zone {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: #fafafa;
        position: relative;
    }

    .file-input-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }

    .file-drop-zone:hover {
        border-color: #76b900;
        background: rgba(118, 185, 0, 0.05);
    }

    .file-select-label {
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .upload-icon {
        font-size: 2.5rem;
    }

    .upload-text {
        font-size: 1rem;
        color: #333;
        font-weight: 500;
    }

    .supported-formats {
        font-size: 0.85rem;
        color: #666;
    }

    .selected-file-info {
        margin-top: 12px;
        padding: 12px;
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border: 2px solid #76b900;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
    }

    .file-icon {
        font-size: 2rem;
        background: white;
        width: 50px;
        height: 50px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .file-details {
        flex: 1;
    }

    .file-name {
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        word-break: break-all;
    }

    .file-size {
        font-size: 0.85rem;
        color: #666;
        margin-top: 2px;
    }

    .btn-clear {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        border: none;
        background: rgba(0,0,0,0.1);
        border-radius: 50%;
        cursor: pointer;
        font-size: 13px;
        color: #666;
        transition: all 0.2s;
    }

    .btn-clear:hover {
        background: #ff5252;
        color: white;
    }

    /* Configuration Options */
    .section-config {
        border-left: 4px solid #ff9800;
    }

    .config-grid {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .config-option {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .config-option label {
        font-weight: 600;
        color: #555;
        font-size: 0.95rem;
    }

    .config-select {
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    .config-select:hover:not(:disabled) {
        border-color: #ff9800;
    }

    .config-select:focus {
        outline: none;
        border-color: #ff9800;
        box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
    }

    .config-select:disabled {
        background: #f5f5f5;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .config-hint {
        color: #888;
        font-size: 0.85rem;
        font-style: italic;
    }

    .config-option input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin-right: 8px;
        cursor: pointer;
    }

    .config-option input[type="checkbox"]:disabled {
        cursor: not-allowed;
        opacity: 0.5;
    }

    /* Action Button */
    .section-action {
        border-left: 4px solid #2196f3;
        text-align: center;
        padding: 25px;
    }

    .btn-transcribe {
        padding: 18px 50px;
        font-size: 1.3rem;
        font-weight: 600;
        background: linear-gradient(135deg, #76b900 0%, #5a8a00 100%);
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 4px 15px rgba(118, 185, 0, 0.4);
        transition: all 0.3s ease;
    }

    .btn-transcribe:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(118, 185, 0, 0.5);
    }

    .btn-transcribe:active:not(:disabled) {
        transform: translateY(0);
    }

    .btn-transcribe:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-cancel {
        padding: 18px 40px;
        font-size: 1.2rem;
        font-weight: 600;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        border: none;
        border-radius: 50px;
        color: white;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        transition: all 0.3s ease;
        margin-left: 20px;
    }

    .btn-cancel:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5);
    }

    .btn-cancel:active {
        transform: translateY(0);
    }

    .spinner-small {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    /* Result Section with Tabs */
    .section-result {
        border-left: 4px solid #ff9800;
        padding: 20px;
    }

    .result-tabs {
        display: flex;
        gap: 0;
        margin-bottom: 0;
        border-bottom: 2px solid #e0e0e0;
    }

    .result-tab {
        padding: 10px 24px;
        font-size: 0.95rem;
        font-weight: 600;
        background: #f5f5f5;
        border: 2px solid #e0e0e0;
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        color: #666;
        transition: all 0.2s;
        margin-right: 2px;
    }

    .result-tab:hover:not(:disabled) {
        background: #e8e8e8;
        color: #333;
    }

    .result-tab.active {
        background: white;
        color: #333;
        border-color: #ff9800;
        border-bottom: 2px solid white;
        margin-bottom: -2px;
        position: relative;
        z-index: 1;
    }

    .result-tab:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .result-tab-content {
        border: 2px solid #e0e0e0;
        border-top: none;
        border-radius: 0 0 8px 8px;
        padding: 15px;
        background: white;
        min-height: 200px;
    }

    .result-textarea {
        width: 100%;
        min-height: 200px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 1rem;
        line-height: 1.6;
        resize: vertical;
        background: #fafafa;
        color: #333;
    }

    .result-textarea:focus {
        outline: none;
        border-color: #ff9800;
        box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
    }

    .result-textarea::placeholder {
        color: #999;
        font-style: italic;
    }

    .result-format-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
    }

    .format-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .srt-badge {
        background: #e3f2fd;
        color: #1565c0;
    }

    .txt-badge {
        background: #e8f5e9;
        color: #2e7d32;
    }

    .btn-copy, .btn-download {
        padding: 6px 14px;
        font-size: 0.85rem;
        font-weight: 500;
        border: 1px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        background: white;
        color: #555;
        transition: all 0.2s;
    }

    .btn-copy:hover, .btn-download:hover {
        background: #f5f5f5;
        border-color: #bbb;
        color: #333;
    }

    .result-pre {
        background: #fafafa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.9rem;
        line-height: 1.6;
        max-height: 400px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
        color: #333;
    }

    /* Fixed Bottom Progress Log */
    .fixed-log {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #1e1e1e;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transition: height 0.3s ease;
    }

    .fixed-log.expanded {
        height: 280px;
    }

    .fixed-log.collapsed {
        height: 42px;
    }

    .fixed-log-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 20px;
        cursor: pointer;
        user-select: none;
        background: #2d2d2d;
        border-bottom: 1px solid #444;
    }

    .fixed-log-header:hover {
        background: #383838;
    }

    .fixed-log-header h3 {
        color: #d4d4d4;
        font-size: 0.95rem;
        margin: 0;
        flex: 1;
    }

    .log-badge {
        background: #76b900;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 700;
        min-width: 20px;
        text-align: center;
    }

    .fixed-log .collapse-icon {
        color: #aaa;
    }

    .fixed-log .console-log {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 10px 20px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 0.85rem;
        line-height: 1.4;
        height: calc(100% - 42px);
        overflow-y: auto;
        border-radius: 0;
        box-shadow: none;
    }

    .log-entry {
        padding: 3px 0;
        display: flex;
        gap: 10px;
    }

    .log-timestamp {
        color: #858585;
        font-weight: 600;
        flex-shrink: 0;
    }

    .log-message {
        flex: 1;
    }

    .log-entry.info .log-message {
        color: #4fc3f7;
    }

    .log-entry.success .log-message {
        color: #81c784;
    }

    .log-entry.warning .log-message {
        color: #ffb74d;
    }

    .log-entry.error .log-message {
        color: #e57373;
    }

    /* Scrollbar for console */
    .console-log::-webkit-scrollbar {
        width: 8px;
    }

    .console-log::-webkit-scrollbar-track {
        background: #2d2d2d;
        border-radius: 4px;
    }

    .console-log::-webkit-scrollbar-thumb {
        background: #555;
        border-radius: 4px;
    }

    .console-log::-webkit-scrollbar-thumb:hover {
        background: #777;
    }

    /* Animations */
    @@keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @@media (max-width: 900px) {
        .top-columns {
            grid-template-columns: 1fr;
        }

        .transcribe-container {
            padding: 10px;
            padding-bottom: 300px;
        }

        .section-action {
            padding: 15px;
        }

        .btn-transcribe {
            padding: 14px 30px;
            font-size: 1.1rem;
        }

        .file-drop-zone {
            padding: 20px;
        }
    }
</style>
